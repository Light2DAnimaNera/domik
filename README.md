# domik

## –ó–∞–ø—É—Å–∫

1. –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements.txt`.
3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å–≤–æ–∏–º–∏ –∫–ª—é—á–∞–º–∏ –∏ —Ç–æ–∫–µ–Ω–∞–º–∏ (`TELEGRAM_TOKEN`, `OPENAI_API_KEY`, `PAYMENT_TOKEN`, `SHOP_ID`).
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `python bot.py`.

   –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ `Ctrl+C` –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—É —Å–∏–≥–Ω–∞–ª `SIGTERM`. –ë–æ—Ç
   –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö.

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ñ–∞–π–ª–∞ `bot_commands.py`. –ü—Ä–∏ –≤–≤–æ–¥–µ `/start`
–±–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç, –µ—Å—Ç—å –ª–∏ –≤–∞–º 18 –ª–µ—Ç, **–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—â—ë –Ω–µ—Ç –≤ –±–∞–∑–µ**. –ü—Ä–∏
–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
–º–µ–Ω—é –∫–æ–º–∞–Ω–¥ —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–æ–ª–∏. –ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å ¬´–ù–µ—Ç¬ª, —É—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç
¬´üëã –° –í–û–ó–í–†–ê–©–ï–ù–ò–ï–ú {username}¬ª.
–°–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `/help`.
–ö–æ–º–∞–Ω–¥–∞ `/help` —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –º–µ–Ω—é.
–ë–æ—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–æ–º–∞–Ω–¥–∞–º–∏. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´Menu¬ª, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥.

–ë–∞–ª–∞–Ω—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–ª–æ–Ω–∫–µ `credits` —Ç–∞–±–ª–∏—Ü—ã `users`. –°—Ç–æ–∏–º–æ—Å—Ç—å —Å–ø–∏—Å–∞–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ —á–∏—Å–ª—É —Ç–æ–∫–µ–Ω–æ–≤: –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –∑–∞–ø—Ä–æ—Å–∞ —Å—Ç–æ–∏—Ç `0.0020` –µ–¥–∏–Ω–∏—Ü, —Ç–æ–∫–µ–Ω –æ—Ç–≤–µ—Ç–∞ ‚Äî `0.0005`. –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç `token_cost_coeff` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `settings` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω —Ä–∞–≤–µ–Ω `1.0`). –ö–æ–º–∞–Ω–¥–∞ `/balance` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —Ç—Ä–∞—Ç—ã. –í –æ—Ç–≤–µ—Ç–µ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–≤–æ–¥—è—Ç—Å—è —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π, –æ–∫—Ä—É–≥–ª—è—è—Å—å –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É, –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—Ç—Å—è —Å–∏–º–≤–æ–ª–æ–º üù£. –ö–æ–º–∞–Ω–¥–∞ `/coeff` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∑–Ω–∞—Ç—å —Ç–∞—Ä–∏—Ñ–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, –∞ `/set_coeff` ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ. –ö–æ–º–∞–Ω–¥—ã `/coeff` –∏ `/set_coeff` –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
–ö–æ–º–∞–Ω–¥–∞ `/recharge` –≤—ã–≤–æ–¥–∏—Ç –∫–Ω–æ–ø–∫–∏ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç —Å—Å—ã–ª–∫—É –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ YooKassa –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –≤–º–µ—Å—Ç–µ —Å –∫–Ω–æ–ø–∫–æ–π ¬´–ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ¬ª. –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞—é—Ç 20 –∫—Ä–µ–¥–∏—Ç–æ–≤ –Ω–∞ —Å—á—ë—Ç.
–í —Ç–∞–±–ª–∏—Ü–µ `users` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ `blocked`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω–æ —Ä–∞–≤–Ω–æ `0`, –∏
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `1`, –¥–æ—Å—Ç—É–ø
–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.
–ü—Ä–∏ –∫–∞–∂–¥–æ–º —Å–ø–∏—Å–∞–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤ –±–æ—Ç –≤—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å, —Å–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ —É—à–ª–æ –Ω–∞
–æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞, –∞ —Ç–∞–∫–∂–µ —Å–æ–æ–±—â–∞–µ—Ç –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–î–ª—è –≤–µ–¥–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã —Å–µ—Å—Å–∏–∏:
- `/begin` ‚Äî –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é;
- `/end` ‚Äî –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â—É—é –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ—ë –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ. –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
  –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.
–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å `/begin` –≤–æ –≤—Ä–µ–º—è
–¥–µ–π—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ –±–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç: ¬´–ß—Ç–æ –±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é, –∑–∞–≤–µ—Ä—à–∏ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–µ—Å—Å–∏—é¬ª.
–ï—Å–ª–∏ –∏–∑-–∑–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—à–∏–±–∫–∏ —Å–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é –Ω–µ —É–¥–∞–ª–æ—Å—å, –±–æ—Ç —Å–æ–æ–±—â–∏—Ç: ¬´–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é¬ª.

–°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ–ª–µ–µ 10 –º–∏–Ω—É—Ç.
–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `mm-dd-yy HH-MM`.

–û–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏. –ï—Å–ª–∏ –µ—ë –Ω–µ—Ç, –±–æ—Ç
–ø–æ–ø—Ä–æ—Å–∏—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å `/begin`.

–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º SessionSummarizer v4.
–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–æ–ª–∏ –∏ —Ç–µ–∫—Å—Ç—ã –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã (`SELECT role, content ...`).
–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ —Ç–∞–∫–∂–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.

–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `messages` –≤–º–µ—Å—Ç–µ —Å
–æ—Ç–º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏. –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –ú–æ—Å–∫–≤—ã
(UTC+3) –≤ —Ñ–æ—Ä–º–∞—Ç–µ `mm-dd-yy HH-MM`.

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ –±–æ—Ç –∏—â–µ—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ï—Å–ª–∏ –æ–Ω –Ω–∞–π–¥–µ–Ω, –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –º–æ–¥–µ–ª–∏ –≤ —Å–∫—Ä—ã—Ç–æ–º –±–ª–æ–∫–µ
`CONTEXT_PREVIOUS_SESSION_*` –ø–µ—Ä–µ–¥ —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º DOMINA. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ
–≤–∏–¥–∏—Ç —ç—Ç–æ—Ç –±–ª–æ–∫, –Ω–æ –±–æ—Ç —É—á–∏—Ç—ã–≤–∞–µ—Ç –µ–≥–æ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö.

–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—â–µ–Ω–∏—è —Å GPT –∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –º–æ–¥—É–ª–µ
`gpt_client.py`.
